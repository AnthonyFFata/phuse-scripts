NOTE: Copyright (c) 2002-2008 by SAS Institute Inc., Cary, NC, USA.
NOTE: SAS (r) Proprietary Software 9.2 (TS2M3)
      Licensed to F. HOFFMANN LA ROCHE AG, Site 50701490.
NOTE: This session is executing on the X64_VSPRO  platform.



NOTE: SAS initialization used:
      real time           5.08 seconds
      cpu time            2.71 seconds

1        OPTIONS sasautos=(%sysfunc(getoption(sasautos))
1  ! "C:\CSS\phuse-scripts\whitepapers\utilities");

2    /***
3      Qualification tests for PhUSE/CSS utility macro ASSERT_COMPLETE_REFDS
4
5      SETUP:  Ensure that PhUSE/CSS utilities are in the AUTOCALL path
6
7      TEST 1: Single-key checks, 2 data sets
8        a. Check that fractional numeric keys work as expected
9        b. Check that char keys work as expected
10         i.  extra record in REFERENCE is OK
11         ii. extra record in RELATED dset is NOT ok
12
13     TEST 2: Multiple-key checks, multiple related data sets
14       a. Mix of num and char keys
15
16   ***/
17
18
19   *--- SETUP ---*;
20
21     /*** EXECUTE ONE TIME only as needed
22
23       Ensure PhUSE/CSS utilities are in the AUTOCALL path
24       NB: This line is not necessary if PhUSE/CSS utilities are in your default AUTOCALL paths
25
26       OPTIONS sasautos=(%sysfunc(getoption(sasautos))
26 ! "C:\CSS\phuse-scripts\whitepapers\utilities");
27
28     ***/
29
30
31   proc sql;
32     create table my_test_definitions
33       ( test_mac    char(32) label='Name of macro to test',
34         test_id     char(15) label='Test ID for ASSERT_COMPLETE_REFDS',
35         test_dsc    char(80) label='Test Description',
36         test_type   char(5)  label='Test Type (Macro var, String-<B|C|L|T>, Data set, In data
36 ! step)',
37         pparm_dsets char(50)  label='Test values for the positional parameter PNUM',
38         pparm_keys  char(50)  label='Test values for the keyword parameter KNUM',
39         test_expect char(50)  label='EXPECTED test results for each call to
39 ! ASSERT_COMPLETE_REFDS'
40       )
41     ;
NOTE: Table WORK.MY_TEST_DEFINITIONS created, with 0 rows and 7 columns.
42
43     insert into my_test_definitions
44       values('assert_complete_refds', 'refds_01_a_i', 'single num key, single related dset,
44 ! extra REF rec allowed',
45              'D', 'my_reference my_related', 'my_key', '-fail_crds')
46       values('assert_complete_refds', 'refds_01_a_ii', 'single num key, single related dset,
46 ! extra REL rec NOT allowed',
47              'D', 'my_reference my_related_extra', 'my_key', 'exp_fail_crds_1aii=fail_crds')
48       values('assert_complete_refds', 'refds_01_b_i', 'single char key, single related dset,
48 ! extra REF rec allowed',
49              'D', 'my_reference_c my_related_c', 'my_char_key', '-fail_crds')
50       values('assert_complete_refds', 'refds_01_b_ii', 'single char key, single related dset,
50 ! extra REL rec NOT allowed',
51              'D', 'my_reference_c my_related_extra_c', 'my_char_key',
51 ! 'exp_fail_crds_1bii=fail_crds')
52     ;
NOTE: 4 rows were inserted into WORK.MY_TEST_DEFINITIONS.

53   quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.11 seconds
      cpu time            0.11 seconds


54
55
56   * Test 1 - reference and related data sets *;
57
58       * Reference dset CAN have extra record 2.003 *;
59         data my_reference (keep=my_key extra_ref_info)
60              my_reference_c (keep=my_char_key extra_ref_info);
61           do my_key = 0.001, 1.002, 2.003, 3.004;
62             my_char_key    = 'Record '!!put(my_key, best8.-L);
63             extra_ref_info = 'My extra info for key '!!put(my_key, best8.-L);
64             output;
65           end;
66         run;

NOTE: The data set WORK.MY_REFERENCE has 4 observations and 2 variables.
NOTE: The data set WORK.MY_REFERENCE_C has 4 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.05 seconds
      cpu time            0.06 seconds


67
68       data my_related (keep=my_key extra_rel_info)
69            my_related_c (keep=my_char_key extra_rel_info);
70         do my_key = 0.001, 1.002, 3.004;
71           my_char_key    = 'Record '!!put(my_key, best8.-L);
72           extra_rel_info = 'My extra info for key '!!put(my_key, best8.-L);
73           output;
74
75           if ranuni(6743) < 0.5 then do;
76             extra_rel_info = 'Additional info for key '!!put(my_key, best8.-L);
77             output;
78           end;
79         end;
80       run;

NOTE: The data set WORK.MY_RELATED has 6 observations and 2 variables.
NOTE: The data set WORK.MY_RELATED_C has 6 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.04 seconds


81
82       * Related dset CANNOT have extra record 1.5 *;
83         data my_related_extra;
84           set my_related end=NoMore;
85           output;
86           if NoMore then do;
87               my_key = 1.5;
88               extra_rel_info = 'No reference match!';
89             output;
90           end;
91         run;

NOTE: There were 6 observations read from the data set WORK.MY_RELATED.
NOTE: The data set WORK.MY_RELATED_EXTRA has 7 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds


92
93         data my_related_extra_c;
94           set my_related_c end=NoMore;
95           output;
96           if NoMore then do;
97               my_char_key = 'Record 1.5';
98               extra_rel_info = 'No reference match!';
99             output;
100          end;
101        run;

NOTE: There were 6 observations read from the data set WORK.MY_RELATED_C.
NOTE: The data set WORK.MY_RELATED_EXTRA_C has 7 observations and 2 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds


102
103        data exp_fail_crds_1aii;
104          my_key=1.5;   found_ds1=0; found_ds2=1; output;
105          my_key=2.003; found_ds1=1; found_ds2=0; output;
106        run;

NOTE: The data set WORK.EXP_FAIL_CRDS_1AII has 2 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


107
108        data exp_fail_crds_1bii;
109          length my_char_key $15;
110          my_char_key='Record 1.5';   found_ds1=0; found_ds2=1; output;
111          my_char_key='Record 2.003'; found_ds1=1; found_ds2=0; output;
112        run;

NOTE: The data set WORK.EXP_FAIL_CRDS_1BII has 2 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


113
114
115  %util_passfail (my_test_definitions, debug=N);
NOTE: No rows were selected.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds



NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds



NOTE: There were 4 observations read from the data set WORK.MY_TEST_DEFINITIONS.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 10 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds



NOTE (BUILD_MACRO_CALLS): > refds_01_a_i , 1 call(s)
NOTE (BUILD_MACRO_CALLS):  BUILDING MACRO CALL 1
NOTE (BUILD_MACRO_CALLS): GENERATED MACRO CALL 1
%assert_complete_refds( my_reference my_related, my_key)
NOTE (BUILD_MACRO_CALLS): <
NOTE (BUILD_MACRO_CALLS): > refds_01_a_ii , 1 call(s)
NOTE (BUILD_MACRO_CALLS):  BUILDING MACRO CALL 1
NOTE (BUILD_MACRO_CALLS): GENERATED MACRO CALL 1
%assert_complete_refds( my_reference my_related_extra, my_key)
NOTE (BUILD_MACRO_CALLS): <
NOTE (BUILD_MACRO_CALLS): > refds_01_b_i , 1 call(s)
NOTE (BUILD_MACRO_CALLS):  BUILDING MACRO CALL 1
NOTE (BUILD_MACRO_CALLS): GENERATED MACRO CALL 1
%assert_complete_refds( my_reference_c my_related_c, my_char_key)
NOTE (BUILD_MACRO_CALLS): <
NOTE (BUILD_MACRO_CALLS): > refds_01_b_ii , 1 call(s)
NOTE (BUILD_MACRO_CALLS):  BUILDING MACRO CALL 1
NOTE (BUILD_MACRO_CALLS): GENERATED MACRO CALL 1
%assert_complete_refds( my_reference_c my_related_extra_c, my_char_key)
NOTE (BUILD_MACRO_CALLS): <
NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds



NOTE: There were 1 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds



NOTE: The file PFEXCODE is:
      Filename=C:\Users\ditommd1\AppData\Local\Temp\SAS Temporary Files\_TD8684\#LN00011,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=03Jun2015:16:19:42,
      Create Time=03Jun2015:16:19:42

NOTE: 1 record was written to the file PFEXCODE.
      The minimum record length was 56.
      The maximum record length was 56.
NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.04 seconds



NOTE: There were 4 observations read from the data set WORK.MY_REFERENCE.
NOTE: 0 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET1 has 4 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds



NOTE: There were 6 observations read from the data set WORK.MY_RELATED.
NOTE: 3 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET2 has 3 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds



NOTE: There were 4 observations read from the data set WORK.CRDS_DSET1.
NOTE: There were 3 observations read from the data set WORK.CRDS_DSET2.
NOTE: The data set WORK.FAIL_CRDS has 1 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds


NOTE: (ASSERT_COMPLETE_REFDS) Result is PASS. MY_REFERENCE includes all subjects.

NOTE: Deleting WORK.CRDS_DSET1 (memtype=DATA).
NOTE: Deleting WORK.CRDS_DSET2 (memtype=DATA).
NOTE: Deleting WORK.FAIL_CRDS (memtype=DATA).
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.07 seconds
      cpu time            0.06 seconds



NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has been updated.  There were 4 observations rewritten, 0
      observations added and 0 observations deleted.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds



NOTE: The file PFEXCODE is:
      Filename=C:\Users\ditommd1\AppData\Local\Temp\SAS Temporary Files\_TD8684\#LN00011,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=03Jun2015:16:19:42,
      Create Time=03Jun2015:16:19:42

NOTE: 1 record was written to the file PFEXCODE.
      The minimum record length was 62.
      The maximum record length was 62.
NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds



NOTE: There were 4 observations read from the data set WORK.MY_REFERENCE.
NOTE: 0 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET1 has 4 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds



NOTE: There were 7 observations read from the data set WORK.MY_RELATED_EXTRA.
NOTE: 3 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET2 has 4 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds



ERROR: (ASSERT_COMPLETE_REFDS) Result is FAIL. Obs missing from reference dset MY_REFERENCE: 1.5
in_ds1=0 in_ds2=1
NOTE: There were 4 observations read from the data set WORK.CRDS_DSET1.
NOTE: There were 4 observations read from the data set WORK.CRDS_DSET2.
NOTE: The data set WORK.FAIL_CRDS has 2 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds



NOTE: Deleting WORK.CRDS_DSET1 (memtype=DATA).
NOTE: Deleting WORK.CRDS_DSET2 (memtype=DATA).
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds



NOTE: There were 2 observations read from the data set WORK.EXP_FAIL_CRDS_1AII.
NOTE: There were 2 observations read from the data set WORK.FAIL_CRDS.
NOTE: PROCEDURE COMPARE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds



NOTE: Deleting WORK.FAIL_CRDS (memtype=DATA).
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds



NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has been updated.  There were 4 observations rewritten, 0
      observations added and 0 observations deleted.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds



NOTE: The file PFEXCODE is:
      Filename=C:\Users\ditommd1\AppData\Local\Temp\SAS Temporary Files\_TD8684\#LN00011,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=03Jun2015:16:19:42,
      Create Time=03Jun2015:16:19:42

NOTE: 1 record was written to the file PFEXCODE.
      The minimum record length was 65.
      The maximum record length was 65.
NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds



NOTE: There were 4 observations read from the data set WORK.MY_REFERENCE_C.
NOTE: 0 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET1 has 4 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds



NOTE: There were 6 observations read from the data set WORK.MY_RELATED_C.
NOTE: 3 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET2 has 3 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds



NOTE: There were 4 observations read from the data set WORK.CRDS_DSET1.
NOTE: There were 3 observations read from the data set WORK.CRDS_DSET2.
NOTE: The data set WORK.FAIL_CRDS has 1 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


NOTE: (ASSERT_COMPLETE_REFDS) Result is PASS. MY_REFERENCE_C includes all subjects.

NOTE: Deleting WORK.CRDS_DSET1 (memtype=DATA).
NOTE: Deleting WORK.CRDS_DSET2 (memtype=DATA).
NOTE: Deleting WORK.FAIL_CRDS (memtype=DATA).
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds



NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has been updated.  There were 4 observations rewritten, 0
      observations added and 0 observations deleted.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.01 seconds



NOTE: The file PFEXCODE is:
      Filename=C:\Users\ditommd1\AppData\Local\Temp\SAS Temporary Files\_TD8684\#LN00011,
      RECFM=V,LRECL=32767,File Size (bytes)=0,
      Last Modified=03Jun2015:16:19:43,
      Create Time=03Jun2015:16:19:42

NOTE: 1 record was written to the file PFEXCODE.
      The minimum record length was 71.
      The maximum record length was 71.
NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds



NOTE: There were 4 observations read from the data set WORK.MY_REFERENCE_C.
NOTE: 0 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET1 has 4 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds



NOTE: There were 7 observations read from the data set WORK.MY_RELATED_EXTRA_C.
NOTE: 3 observations with duplicate key values were deleted.
NOTE: The data set WORK.CRDS_DSET2 has 4 observations and 1 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.02 seconds
      cpu time            0.03 seconds



ERROR: (ASSERT_COMPLETE_REFDS) Result is FAIL. Obs missing from reference dset MY_REFERENCE_C:
Record 1.5 in_ds1=0 in_ds2=1
NOTE: There were 4 observations read from the data set WORK.CRDS_DSET1.
NOTE: There were 4 observations read from the data set WORK.CRDS_DSET2.
NOTE: The data set WORK.FAIL_CRDS has 2 observations and 3 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds



NOTE: Deleting WORK.CRDS_DSET1 (memtype=DATA).
NOTE: Deleting WORK.CRDS_DSET2 (memtype=DATA).
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds



NOTE: There were 2 observations read from the data set WORK.EXP_FAIL_CRDS_1BII.
NOTE: There were 2 observations read from the data set WORK.FAIL_CRDS.
NOTE: PROCEDURE COMPARE used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds



NOTE: Deleting WORK.FAIL_CRDS (memtype=DATA).
NOTE: PROCEDURE DATASETS used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds



NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has been updated.  There were 4 observations rewritten, 0
      observations added and 0 observations deleted.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds



NOTE: 11 lines were written to file PRINT.
NOTE: There were 4 observations read from the data set WORK.CSS_PASSFAIL.
NOTE: The data set WORK.CSS_PASSFAIL has 4 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds



